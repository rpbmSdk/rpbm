<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="rpbm_agent.AgentWidgetDialog">
        <Dialog size="lg" title="Agent">
            <t t-if="!agentsInitialized">
                <div class="d-flex justify-content-center">
                    <i class="fa fa-spinner fa-spin fa-2x"></i>
                    <t t-esc="loadingMessage"/>
                    <!-- <t t-esc="agentsInitialized"/> -->
                </div>
            </t>
            <t t-else="">
                <label for="immatriculation">Immatriculation</label>
                <input class="o_input" id="immatriculation" t-att-value="immatriculationValue" placeholder="Immatriculation" t-ref="immatriculation" t-on-change="onChangeImmatriculation" style="text-transform: uppercase;margin: 10px;" />
                <button class="btn btn-primary" t-on-click="onSearchImmatriculation">
                    Search
                </button>
                <t t-if="vehicules.length > 0">
                    <t t-foreach="vehicules" t-as="vehicule" t-key="vehicule.id">
                        <VehiculeComponent record="record" vehicule="vehicule" immatriculation="immatriculationValue" selectedVehiculeId="selectedVehiculeId" t-on-click="()=>this.onSelectVehicule(vehicule.id)" />
                    </t>
                    <button t-if="selectedVehicule" class="btn btn-primary" t-on-click="onGetPlanche">
                    Rechercher les Catégories
                    </button>
                    <t t-if="planche">
                        <div>
                            <t t-foreach="calques" t-as="calque" t-key="calque.id">
                                <CalqueComponent calque="calque" selectedCalqueId="selectedCalqueId" t-on-click="()=>this.onClickCalque(calque.id)" />
                            </t>
                            <div>
                                <button t-if="selectedCalque" class="btn btn-primary" t-on-click="getPieces">
                            Charger les pièces
                                </button>
                            </div>

                        </div>
                        <div>

                            <div t-if="pieces.length > 0" class="d-flex justify-content-between" style="flex-wrap: wrap;">
                                <t t-foreach="pieces" t-as="piece" t-key="piece.id">
                                    <PieceComponent piece="piece" selectedPieceId="selectedPieceId" t-on-click="()=>this.onSelectPiece(piece.id)" />
                                </t>

                            </div>

                        </div>
                        <div t-if="selectedPiece">
                            <label for="baseEurocode">baseEurocode</label>
                            <input class="o_input" id="baseEurocode" t-att-value="baseEurocode" placeholder="Base Eurocode" t-ref="baseEurocode" t-on-change="onChangeBaseEurocode" style="margin: 10px;" />
                            <button class="btn btn-primary" t-on-click="onSearchBaseEurocode">
                            Rechercher sur VSF
                            </button>
                        </div>

                        <div t-if="articlesVsf.length > 0">
                            <t t-foreach="articlesVsf" t-as="articleVsf" t-key="articleVsf.code">
                                <div class="d-flex justify-content-between" style="flex-wrap: wrap;">
                                    <ArticleComponent record="record" article="articleVsf" selectedArticleId="selectedArticleId" t-on-click="()=>onClickArticleVsf(articleVsf.code)" />
                                    <a t-att-href="articleVsf.url" target="_blank" class="btn btn-primary" style="height: fit-content;">Fiche technique</a>
                                    <t t-foreach="articleVsf.absoluteImgUrls" t-as="absoluteImgUrl" t-key="absoluteImgUrl">
                                        <img t-att-src="absoluteImgUrl" style="width: 100px; height: 100px; margin: 5px;" />
                                    </t>
                                </div>
                            </t>
                        </div>
                    </t>
                </t>
                <t t-set-slot="footer">
                        <button class="btn btn-primary" t-on-click="onConfirm" > <!-- FIXME: t-att-disabled="!state.canConfirm" -->
                            Confirm
                        </button>

                    <button class="btn btn-secondary" t-on-click="onDiscard">
                        Cancel
                    </button>
                </t>
            </t>
        </Dialog>

    </t>
</templates>